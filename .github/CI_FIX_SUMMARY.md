# GitHub Actions CI/CD ä¿®å¤æ€»ç»“

## ğŸ¯ ä¿®å¤çš„é—®é¢˜

### 1. âœ… Linux ç¼–è¯‘é”™è¯¯ - ç³»ç»Ÿä¾èµ–ç¼ºå¤±
**é”™è¯¯**: `glib-2.0` åº“æ‰¾ä¸åˆ°
**ä¿®å¤**: åœ¨ CI é…ç½®ä¸­æ·»åŠ  Ubuntu ç³»ç»Ÿä¾èµ–å®‰è£…æ­¥éª¤

### 2. âœ… è·¨å¹³å°ç¼–è¯‘é”™è¯¯ - å‡½æ•°æœªå®šä¹‰
**é”™è¯¯**: `is_core_running` å’Œ `cleanup_port` å‡½æ•°åœ¨é macOS å¹³å°æ‰¾ä¸åˆ°
**ä¿®å¤**: ä¸º Windows å’Œ Linux æ·»åŠ è¿™äº›å‡½æ•°çš„å®ç°

### 3. âœ… iOS ç¼–è¯‘é”™è¯¯ - Tauri CLI ç¼ºå¤±
**é”™è¯¯**: `cargo: no such command: tauri`
**ä¿®å¤**: åœ¨ iOS æ„å»ºæ­¥éª¤ä¸­æ·»åŠ  Tauri CLI å®‰è£…

### 4. âœ… macOS ç­¾åé”™è¯¯ - è¯ä¹¦å¯¼å…¥å¤±è´¥
**é”™è¯¯**: `SecKeychainItemImport: One or more parameters passed to a function were not valid`
**ä¿®å¤**: 
- åœ¨ `tauri.conf.json` ä¸­è®¾ç½® `signingIdentity: null`
- ç®€åŒ– CI é…ç½®,ç§»é™¤å¤æ‚çš„æ¡ä»¶åˆ¤æ–­
- è®© Tauri è‡ªåŠ¨å¤„ç†æœ‰æ— è¯ä¹¦çš„æƒ…å†µ

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `.github/workflows/ci.yml`
- æ·»åŠ  Linux ç³»ç»Ÿä¾èµ–å®‰è£…
- æ·»åŠ  iOS Tauri CLI å®‰è£…
- ä¼˜åŒ– Rust ç¼“å­˜é…ç½®
- ç®€åŒ–æ„å»ºæ­¥éª¤

### 2. `src-tauri/src/core/base.rs`
- ä¸º Windows å’Œ Linux æ·»åŠ  `is_core_running` å‡½æ•°
- ä¸º Windows å’Œ Linux æ·»åŠ  `cleanup_port` å‡½æ•°

### 3. `src-tauri/tauri.conf.json`
- æ·»åŠ  macOS ç­¾åé…ç½®: `signingIdentity: null`
- å…è®¸æ„å»ºæœªç­¾åçš„åº”ç”¨

### 4. æ–°å¢æ–‡ä»¶
- `.github/SECRETS_SETUP.md` - GitHub Secrets é…ç½®æŒ‡å—
- `.github/setup_secrets.sh` - äº¤äº’å¼é…ç½®è„šæœ¬

---

## ğŸš€ å½“å‰çŠ¶æ€

### CI/CD æµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Push/Tag       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Test Job       â”‚  â† Ubuntu, æµ‹è¯•ä»£ç 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Build Job      â”‚  â† å¤šå¹³å°æ„å»º
â”‚  â”œâ”€ macOS       â”‚
â”‚  â”œâ”€ Windows     â”‚
â”‚  â””â”€ iOS         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Upload         â”‚  â† ä¸Šä¼ æ„å»ºäº§ç‰©
â”‚  Artifacts      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Release        â”‚  â† ä»…åœ¨ tag æ—¶åˆ›å»º
â”‚  (if tag)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ„å»ºæ¨¡å¼

#### å½“å‰æ¨¡å¼ (æ— ç­¾å)
- âœ… å¯ä»¥æˆåŠŸæ„å»º
- âœ… åº”ç”¨å¯ä»¥åœ¨å¼€å‘æœºä¸Šè¿è¡Œ
- âš ï¸ å…¶ä»–ç”¨æˆ·éœ€è¦å³é”®æ‰“å¼€æˆ–åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å…è®¸

#### ç­¾åæ¨¡å¼ (éœ€è¦é…ç½® Secrets)
é…ç½®ä»¥ä¸‹ GitHub Secrets åè‡ªåŠ¨å¯ç”¨:
- `APPLE_CERTIFICATE`
- `APPLE_CERTIFICATE_PASSWORD`
- `APPLE_SIGNING_IDENTITY`
- `APPLE_TEAM_ID`

---

## ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ

### é€‰é¡¹ A: ç»§ç»­ä½¿ç”¨æœªç­¾åæ„å»º (å½“å‰çŠ¶æ€)
```bash
# æ— éœ€é¢å¤–æ“ä½œ,CI ä¼šè‡ªåŠ¨æ„å»ºæœªç­¾åçš„åº”ç”¨
# é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•é˜¶æ®µ
```

### é€‰é¡¹ B: é…ç½®ç­¾å (æ¨èç”¨äºå‘å¸ƒ)

#### 1. è¿è¡Œé…ç½®è„šæœ¬
```bash
cd /Users/a1024/code/aqiu
./.github/setup_secrets.sh
```

#### 2. ä¸Šä¼  Secrets åˆ° GitHub
è®¿é—®: https://github.com/o0x1024/aqiu/settings/secrets/actions

æŒ‰ç…§ `.github/SECRETS_SETUP.md` çš„æŒ‡å—æ·»åŠ  Secrets

#### 3. é‡æ–°è§¦å‘æ„å»º
```bash
git tag v1.0.5
git push origin v1.0.5
```

---

## ğŸ” éªŒè¯æ„å»º

### æŸ¥çœ‹ GitHub Actions
https://github.com/o0x1024/aqiu/actions

### ä¸‹è½½æ„å»ºäº§ç‰©
1. è¿›å…¥ Actions é¡µé¢
2. é€‰æ‹©ä¸€ä¸ªæˆåŠŸçš„ workflow run
3. åœ¨ "Artifacts" éƒ¨åˆ†ä¸‹è½½:
   - `aqiu-macos-aarch64` - macOS åº”ç”¨
   - `aqiu-windows-x64` - Windows åº”ç”¨
   - `aqiu-ios-aarch64` - iOS åº”ç”¨ (å¦‚æœæ„å»ºæˆåŠŸ)

---

## âš ï¸ é‡è¦æç¤º

### è¯ä¹¦ç±»å‹
å½“å‰ä½¿ç”¨çš„æ˜¯ **Apple Development** è¯ä¹¦:
- âœ… é€‚ç”¨äº: å¼€å‘ã€æµ‹è¯•ã€å†…éƒ¨åˆ†å‘
- âŒ ä¸é€‚ç”¨äº: å…¬å¼€åˆ†å‘ã€App Store

### å‡çº§åˆ°ç”Ÿäº§è¯ä¹¦
å¦‚éœ€å…¬å¼€åˆ†å‘,éœ€è¦ç”³è¯· **Developer ID Application** è¯ä¹¦:
1. è®¿é—® https://developer.apple.com/account
2. Certificates â†’ Create â†’ Developer ID Application
3. ä¸‹è½½å¹¶å¯¼å‡ºä¸º .p12
4. æ›´æ–° GitHub Secrets

### æœªç­¾ååº”ç”¨çš„ä½¿ç”¨
macOS ç”¨æˆ·æ‰“å¼€æœªç­¾ååº”ç”¨:
1. å³é”®ç‚¹å‡»åº”ç”¨
2. é€‰æ‹© "æ‰“å¼€"
3. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ç‚¹å‡» "æ‰“å¼€"

æˆ–è€…:
1. ç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§
2. æ‰¾åˆ°è¢«é˜»æ­¢çš„åº”ç”¨
3. ç‚¹å‡» "ä»è¦æ‰“å¼€"

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Tauri æ„å»ºæ–‡æ¡£](https://tauri.app/v1/guides/building/)
- [Tauri macOS ç­¾å](https://tauri.app/v1/guides/distribution/sign-macos)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [Apple Developer Portal](https://developer.apple.com/account)

---

## ğŸ‰ æ€»ç»“

æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤,CI/CD æµç¨‹å·²å®Œå–„:
- âœ… æ”¯æŒ macOS (Apple Silicon)
- âœ… æ”¯æŒ Windows (x64)
- âœ… æ”¯æŒ iOS (éœ€è¦è¿›ä¸€æ­¥æµ‹è¯•)
- âœ… è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒ
- âœ… çµæ´»çš„ç­¾åé…ç½®

ç°åœ¨å¯ä»¥ä¸“æ³¨äºåŠŸèƒ½å¼€å‘,CI/CD ä¼šè‡ªåŠ¨å¤„ç†æ„å»ºå’Œå‘å¸ƒ! ğŸš€
