import { ref } from 'vue';

type Locale = 'en' | 'zh';

type MessageValue = string | { [key: string]: MessageValue };

const messages: Record<Locale, MessageValue> = {
    en: {
        app: {
            title: 'AQiu',
            subtitle: 'BY LIKE',
        },
        nav: {
            main: 'Main',
            network: 'Network',
            dashboard: 'Dashboard',
            proxies: 'Proxies',
            rules: 'Rules',
            profiles: 'Profiles',
            connections: 'Connections',
            logs: 'Logs',
            settings: 'Settings',
        },
        actions: {
            add: 'Add',
            save: 'Save',
            cancel: 'Cancel',
            delete: 'Delete',
            edit: 'Edit',
            rename: 'Rename',
            download: 'Download',
            import: 'Import',
            apply: 'Apply',
            clear: 'Clear',
            start: 'Start',
            stop: 'Stop',
            restart: 'Restart',
            refresh: 'Refresh',
            testAll: 'Test All',
            closeAll: 'Close All',
            showAdvanced: 'Show Advanced',
            hideAdvanced: 'Hide Advanced',
        },
        common: {
            tun: 'TUN',
            on: 'ON',
            off: 'OFF',
            enabled: 'Enabled',
            disabled: 'Disabled',
            unknown: 'Unknown',
            global: 'Global',
            rule: 'Rule',
            direct: 'Direct',
            total: '{count} total',
            selected: '{count} selected',
            active: 'Active',
        },
        core: {
            missingTitle: 'Mihomo core not found',
            missingHint: 'Please download the core to start using the proxy.',
            downloadStarting: 'Starting...',
            downloadFailed: 'Failed: {error}',
            downloadInProgress: 'Downloading...',
            autoStartFailed: 'Failed to auto-start core: {error}',
        },
        dashboard: {
            title: 'Dashboard',
            systemIs: 'System is',
            statusReady: 'READY',
            statusOptimized: 'OPTIMIZED',
            statusSecure: 'SECURE',
            statusFast: 'FAST',
            proxyLabel: 'Proxy',
            coreStatusRunning: 'Core: Running',
            coreStatusStopped: 'Core: Stopped',
            totalLabel: 'Total:',
            trafficTitle: 'Real-time Traffic',
            down: 'Down',
            up: 'Up',
            collecting: 'Collecting data...',
            statsDownload: 'Download',
            statsUpload: 'Upload',
            statsConnections: 'Connections',
            statsMode: 'Mode',
            modeUpdateFailed: 'Failed to change mode: {error}',
        },
        proxies: {
            title: 'Proxies',
            addGroup: 'Add Group',
            editGroup: 'Edit Group',
            deleteGroup: 'Delete Group',
            group: 'Group',
            groupName: 'Group Name',
            groupType: 'Type',
            testUrl: 'Test URL',
            intervalSeconds: 'Interval (seconds)',
            selectProxies: 'Select Proxies',
            proxyGroup: 'Proxy Group',
            groupSaved: 'Group saved successfully! Restart core to apply changes.',
            groupDeleted: 'Group deleted successfully! Restart core to apply changes.',
            groupNameRequired: 'Please enter a group name',
            groupProxyRequired: 'Please select at least one proxy',
            addFailed: 'Failed to save group: {error}',
            deleteFailed: 'Failed to delete group: {error}',
            deleteConfirm: 'Are you sure you want to delete group "{name}"?',
            typeSelector: 'Selector',
            typeUrlTest: 'URLTest',
            typeFallback: 'Fallback',
            typeLoadBalance: 'LoadBalance',
            typeDescSelector: 'Manual selection',
            typeDescUrlTest: 'Auto select fastest',
            typeDescFallback: 'Auto failover',
            typeDescLoadBalance: 'Load balancing',
            addProxyGroupTitle: '{mode} Proxy Group',
            allNodes: 'All Individual Nodes',
            diagnosticsTitle: 'API Diagnostics',
            coreRunning: 'Core Running',
            totalFetched: 'Total Fetched',
            fetchedNodes: 'Fetched Nodes (First 10):',
            diagnosticsTip: 'Tip: Make sure you\'ve selected a profile and clicked "Apply" (Restart).',
        },
        rules: {
            title: 'Rules',
            addRule: 'Add Rule',
            searchPlaceholder: 'Search rules...',
            addTitle: 'Add New Rule',
            ruleType: 'Rule Type',
            ruleTypeHint: 'Type of matching rule',
            payload: 'Payload',
            payloadHint: 'Value to match against',
            target: 'Target',
            targetHint: 'Proxy group or policy',
            payloadRequired: 'Please enter a payload',
            addedSuccess: 'Rule added successfully! Restart core to apply changes.',
            addFailed: 'Failed to add rule: {error}',
            tableType: 'Type',
            tablePayload: 'Payload',
            tableTarget: 'Target',
        },
        connections: {
            title: 'Connections',
            active: '{count} active',
            activeHint: 'active',
            searchPlaceholder: 'Search connections...',
            tableHost: 'Host',
            tableNetwork: 'Network',
            tableRule: 'Rule',
            tableProxy: 'Proxy',
            tableTotalDownload: 'Total Download',
            tableTotalUpload: 'Total Upload',
            tableDownload: 'Download',
            tableUpload: 'Upload',
        },
        logs: {
            title: 'Logs',
            levelAll: 'All',
            levelDebug: 'Debug',
            levelInfo: 'Info',
            levelWarning: 'Warning',
            levelError: 'Error',
            empty: 'No logs available',
            pause: 'Pause',
            resume: 'Resume',
            clear: 'Clear',
            filterPlaceholder: 'Filter logs...',
        },
        settings: {
            title: 'Settings',
            coreSection: 'Core Management',
            coreStatus: 'Core Status',
            coreStatusHint: 'Current running state of Mihomo',
            running: 'Running',
            stopped: 'Stopped',
            coreVersion: 'Version',
            coreVersionHint: 'Mihomo core version',
            apiPort: 'API Port',
            apiPortHint: 'Port for Mihomo external controller',
            apiPortSave: 'Save',
            apiPortSaved: 'API port updated. Restart core to apply.',
            apiPortSaveFailed: 'Failed to update API port: {error}',
            apiPortInvalid: 'Please enter a valid port (1-65535).',
            coreBinary: 'Binary File',
            coreBinaryHint: 'Executable location status',
            coreFound: 'Found',
            coreBinarySelect: 'Choose File',
            coreBinaryImported: 'Binary imported: {path}',
            coreBinaryImportFailed: 'Failed to import binary: {error}',
            networkSection: 'Network Settings',
            systemProxy: 'System Proxy',
            systemProxyHint: 'Route system traffic through Mihomo',
            tunMode: 'TUN Mode',
            tunModeHint: 'Virtual network interface (requires admin/root)',
            tunRequiresHelper: 'Authorize helper first to enable TUN without password prompts.',
            allowLan: 'Allow LAN',
            allowLanHint: 'Accept connections from local network',
            appearance: 'Appearance',
            theme: 'Theme',
            themeHint: 'Choose from daisyUI themes',
            quickImport: 'Quick Import',
            subscriptionUrl: 'Subscription URL',
            importHint: 'https://example.com/config.yaml',
            downloadingConfig: 'Downloading config...',
            configSaved: 'Config saved successfully! Please restart core to apply.',
            configUrlRequired: 'Please enter a config URL',
            configDownloadFailed: 'Failed to download config: {error}',
            coreDownloadSuccess: 'Core downloaded successfully!',
            coreDownloadFailed: 'Failed to download core: {error}',
            geodata: 'GeoIP Database',
            geodataHint: 'Download GeoIP and GeoSite data for DNS rules',
            syncGeodata: 'Sync',
            geodataDownloadSuccess: 'GeoIP/GeoSite data downloaded successfully!',
            geodataDownloadFailed: 'Failed to download geodata: {error}',
            tunToggleSuccess: 'TUN mode {state} successfully!',
            tunToggleFailed: 'Failed to toggle TUN mode. Ensure you have admin/root privileges.',
            tunToggleFailedDetail: 'Failed to toggle TUN mode: {error}',
            pathsSection: 'Application Paths',
            configDir: 'Config Directory',
            dataDir: 'Data Directory',
            openPath: 'Open Folder',
            openPathFailed: 'Failed to open path: {error}',
            language: 'Language',
            inboundPorts: 'Proxy Ports',
            portHttp: 'HTTP Port',
            portSocks: 'SOCKS Port',
            portMixed: 'Mixed Port',
            portRedir: 'Redir Port',
            portTproxy: 'TProxy Port',
            savePorts: 'Save Ports',
            portsSaved: 'Proxy updated.',
            portsSaveFailed: 'Failed to update ports: {error}',
            showTraySpeed: 'Show Speed in Tray',
            showTraySpeedHint: 'Display real-time traffic in macOS status bar',
            privilegedHelper: 'Silent Mode (Helper)',
            privilegedHelperHint: 'Authorize a system-level binary to toggle TUN mode without password prompts.',
            authorize: 'Authorize',
            uninstall: 'Uninstall',
            reauthorize: 'Reauthorize',
            authorized: 'Authorized',
            helperInstallSuccess: 'Silent mode authorized successfully! You can now toggle TUN mode freely.',
            helperInstallFailed: 'Failed to authorize silent mode: {error}',
            helperUninstallSuccess: 'Service mode uninstalled successfully',
            tunRequiresServiceMode: 'TUN mode requires Service Mode. Please allow installation.',
            switchedToServiceModeForTun: 'Switched to Service Mode for TUN mode',
            toggleFailed: 'Action failed: {error}',
            coreMode: 'Core Mode',
            coreModeHint: 'Choose how Mihomo runs on your system',
            userMode: 'User Mode',
            serviceMode: 'Service Mode',
            userModeDesc: 'Runs in your user session, requires sudo for TUN mode',
            serviceModeDesc: 'Runs as system service with root privileges, auto-start on boot',
            switchedToUserMode: 'Switched to User Mode',
            switchedToServiceMode: 'Switched to Service Mode',
            coreModeSwitchFailed: 'Failed to switch mode: {error}',
            helperRequiredForService: 'Please install Service Mode first',
        },
        profiles: {
            title: 'Configuration Profiles',
            profiles: 'Profiles',
            noProfiles: 'No profiles',
            selectOrCreate: 'Select or create a profile to start editing',
            active: 'Active',
            activate: 'Activate',
            update: 'Update',
            delete: 'Delete',
            rename: 'Rename',
            editorVisual: 'Visual',
            editorYaml: 'YAML',
            saveChanges: 'Save Changes',
            generalSettings: 'General Settings',
            mixedPort: 'Mixed Port',
            mode: 'Mode',
            allowLan: 'Allow LAN',
            proxies: 'Proxies',
            importUrl: 'Import URL',
            addProxy: 'Add Proxy',
            noProxies: 'No proxies configured',
            rules: 'Rules',
            addRule: 'Add Rule',
            noRules: 'No rules configured',
            moreRules: 'And {count} more rules...',
            proxyGroups: 'Proxy Groups',
            addGroup: 'Add Group',
            noGroups: 'No proxy groups configured',
            groupName: 'Name',
            groupType: 'Type',
            groupUrl: 'URL (optional)',
            groupInterval: 'Interval',
            groupProxies: 'Proxies (one per line)',
            dns: 'DNS',
            dnsEnable: 'Enable',
            dnsIpv6: 'IPv6',
            dnsUseHosts: 'Use Hosts',
            dnsEnhancedMode: 'Enhanced Mode',
            dnsFakeIpRange: 'Fake-IP Range',
            dnsNameserver: 'Nameserver (one per line)',
            tun: 'TUN',
            tunEnable: 'Enable',
            tunStack: 'Stack',
            tunDevice: 'Device',
            tunAutoRoute: 'Auto Route',
            tunAutoDetect: 'Auto Detect Interface',
            tunMtu: 'MTU',
            addProfile: 'Create New Profile',
            profileName: 'Profile Name',
            profileUrl: 'Subscription URL (Optional)',
            profilePath: 'Local File Path (Optional)',
            profilePathHint: 'C:\\path\\to\\config.yaml',
            profileSource: 'Profile Source',
            profileSourceEmpty: 'Empty',
            profileSourceUrl: 'Subscription URL',
            profileSourceFile: 'Local File',
            chooseFile: 'Choose File',
            createMissingUrl: 'Please enter a subscription URL.',
            createMissingPath: 'Please choose a local file.',
            filePickFailed: 'Failed to open file picker: {error}',
            create: 'Create',
            cancel: 'Cancel',
            addProxyTitle: '{mode} Proxy',
            nameRequired: 'Name and Server are required',
            proxyName: 'Name',
            proxyType: 'Type',
            proxyServer: 'Server',
            proxyPort: 'Port',
            proxyPassword: 'Password',
            proxyUuid: 'UUID',
            proxyCipher: 'Cipher',
            proxyAlterId: 'Alter ID',
            proxyVmessCipher: 'VMess Cipher',
            proxySni: 'SNI',
            proxyUdp: 'UDP',
            proxyTls: 'TLS',
            saveProxy: 'Save Proxy',
            yamlPlaceholder: '# Paste your Clash YAML here...',
            importProxyUrlPrompt: 'Enter proxy URL (ss://, vmess://, trojan://)',
            addRulePrompt: 'Enter rule (e.g., DOMAIN-SUFFIX,google.com,Proxy)',
            createFailed: 'Failed to create profile: {error}',
            deleteConfirm: 'Are you sure you want to delete this profile?',
            deleteFailed: 'Failed to delete profile: {error}',
            activateConfirm: 'Activate this profile and restart the Mihomo core to apply the configuration?',
            tunRequiresHelper: 'This profile enables TUN. Authorize helper first to avoid password prompts.',
            activateFailed: 'Failed to set active profile: {error}',
            saveSuccess: 'Saved successfully!',
            saveFailed: 'Failed to save: {error}',
            updateFailed: 'Failed to update: {error}',
            updateSuccess: 'Updated successfully!',
            missingUrl: 'This profile has no subscription URL',
            renamePrompt: 'Rename profile',
            renameFailed: 'Failed to rename profile: {error}',
            downloadConfigPrompt: 'Please enter a config URL',
            importFailed: 'Failed to parse proxy URL: {error}',
            proxyAdded: 'Proxy added successfully!',
            configSavedPath: 'Config saved to: {path}\nPlease restart core to apply.',
        },
    },
    zh: {
        app: {
            title: 'AQiu 代理',
            subtitle: 'fake you',
        },
        nav: {
            main: '主界面',
            network: '网络',
            dashboard: '概览',
            proxies: '代理',
            rules: '规则',
            profiles: '订阅',
            connections: '连接',
            logs: '日志',
            settings: '设置',
        },
        actions: {
            add: '新增',
            save: '保存',
            cancel: '取消',
            delete: '删除',
            edit: '编辑',
            rename: '重命名',
            download: '下载',
            import: '导入',
            apply: '应用',
            clear: '清除',
            start: '启动',
            stop: '停止',
            restart: '重启',
            refresh: '刷新',
            testAll: '测试全部',
            closeAll: '全部关闭',
            showAdvanced: '显示更多',
            hideAdvanced: '收起',
        },
        common: {
            tun:"TUN",
            on: '开',
            off: '关',
            enabled: '已开启',
            disabled: '已关闭',
            unknown: '未知',
            global: '全局',
            rule: '规则',
            direct: '直连',
            total: '共 {count} 条',
            selected: '已选 {count} 项',
        },
        core: {
            missingTitle: '未找到 Mihomo 内核',
            missingHint: '请先下载内核以开始使用代理。',
            downloadStarting: '开始下载...',
            downloadFailed: '下载失败：{error}',
            downloadInProgress: '下载中...',
            autoStartFailed: '自动启动内核失败：{error}',
        },
        dashboard: {
            title: '概览',
            systemIs: '系统状态',
            statusReady: '就绪',
            statusOptimized: '优化',
            statusSecure: '安全',
            statusFast: '高速',
            proxyLabel: '系统代理',
            coreStatusRunning: '内核运行中',
            coreStatusStopped: '内核未运行',
            totalLabel: '总量：',
            trafficTitle: '实时流量',
            down: '下行',
            up: '上行',
            collecting: '正在收集数据...',
            statsDownload: '下载',
            statsUpload: '上传',
            statsConnections: '连接数',
            statsMode: '模式',
            modeUpdateFailed: '切换模式失败：{error}',
        },
        proxies: {
            title: '代理',
            addGroup: '新增分组',
            editGroup: '编辑分组',
            deleteGroup: '删除分组',
            group: '分组',
            groupName: '分组名称',
            groupType: '类型',
            testUrl: '测试地址',
            intervalSeconds: '间隔（秒）',
            selectProxies: '选择代理',
            proxyGroup: '代理分组',
            groupSaved: '分组已保存！请重启内核生效。',
            groupDeleted: '分组已删除！请重启内核生效。',
            groupNameRequired: '请输入分组名称',
            groupProxyRequired: '请至少选择一个代理',
            addFailed: '保存分组失败：{error}',
            deleteFailed: '删除分组失败：{error}',
            deleteConfirm: '确认删除分组 "{name}" 吗？',
            typeSelector: '手动选择',
            typeUrlTest: '自动测速',
            typeFallback: '故障转移',
            typeLoadBalance: '负载均衡',
            typeDescSelector: '手动选择节点',
            typeDescUrlTest: '自动选择最快',
            typeDescFallback: '自动故障转移',
            typeDescLoadBalance: '均衡负载',
            addProxyGroupTitle: '{mode} 代理分组',
            allNodes: '所有独立节点',
            diagnosticsTitle: 'API 诊断',
            coreRunning: '内核运行',
            totalFetched: '已获取总数',
            fetchedNodes: '已获取节点（前 10 个）：',
            diagnosticsTip: '提示：请确保已选择订阅并点击"应用"（重启）。',
        },
        rules: {
            title: '规则',
            addRule: '新增规则',
            searchPlaceholder: '搜索规则...',
            addTitle: '新增规则',
            ruleType: '规则类型',
            ruleTypeHint: '匹配规则类型',
            payload: '匹配内容',
            payloadHint: '需要匹配的值',
            target: '目标',
            targetHint: '代理分组或策略',
            payloadRequired: '请输入匹配内容',
            addedSuccess: '规则已新增！请重启内核生效。',
            addFailed: '新增规则失败：{error}',
            tableType: '类型',
            tablePayload: '内容',
            tableTarget: '目标',
        },
        connections: {
            title: '连接',
            active: '活跃 {count}',
            activeHint: '活跃',
            searchPlaceholder: '搜索连接...',
            tableHost: '主机',
            tableNetwork: '网络',
            tableRule: '规则',
            tableProxy: '代理',
            tableTotalDownload: '总下载',
            tableTotalUpload: '总上传',
            tableDownload: '下载',
            tableUpload: '上传',
        },
        logs: {
            title: '日志',
            levelAll: '全部',
            levelDebug: '调试',
            levelInfo: '信息',
            levelWarning: '警告',
            levelError: '错误',
            empty: '暂无日志',
            pause: '暂停',
            resume: '继续',
            clear: '清除',
            filterPlaceholder: '过滤条件',
        },
        settings: {
            title: '设置',
            coreSection: '内核管理',
            coreStatus: '内核运行状态',
            coreStatusHint: '当前 Mihomo 运行状态',
            running: '运行中',
            stopped: '已停止',
            coreVersion: '版本',
            coreVersionHint: 'Mihomo 内核版本',
            apiPort: 'API 端口',
            apiPortHint: 'Mihomo 外部控制器端口',
            apiPortSave: '保存',
            apiPortSaved: 'API 端口已更新，请重启内核生效。',
            apiPortSaveFailed: 'API 端口更新失败：{error}',
            apiPortInvalid: '请输入有效端口（1-65535）。',
            coreBinary: '可执行文件',
            coreBinaryHint: '可执行文件位置状态',
            coreFound: '已找到',
            coreBinarySelect: '选择文件',
            coreBinaryImported: '已导入：{path}',
            coreBinaryImportFailed: '导入失败：{error}',
            networkSection: '网络设置',
            systemProxy: '系统代理',
            systemProxyHint: '系统流量走代理',
            tunMode: 'TUN 模式',
            tunModeHint: '虚拟网卡（需要管理员权限）',
            tunRequiresHelper: '请先授权静默模式，避免每次开启 TUN 输入密码。',
            allowLan: '允许局域网',
            allowLanHint: '允许局域网设备连接',
            appearance: '外观',
            theme: '主题',
            themeHint: '选择 daisyUI 主题',
            quickImport: '快速导入',
            subscriptionUrl: '订阅地址',
            importHint: 'https://example.com/config.yaml',
            downloadingConfig: '正在下载配置...',
            configSaved: '配置已保存！请重启内核生效。',
            configUrlRequired: '请输入订阅地址',
            configDownloadFailed: '下载配置失败：{error}',
            coreDownloadSuccess: '内核下载成功！',
            coreDownloadFailed: '下载内核失败：{error}',
            geodata: 'GeoIP 数据库',
            geodataHint: '下载 GeoIP 和 GeoSite 数据用于 DNS 规则',
            syncGeodata: '同步',
            geodataDownloadSuccess: 'GeoIP/GeoSite 数据下载成功！',
            geodataDownloadFailed: '下载地理数据失败：{error}',
            tunToggleSuccess: 'TUN 模式{state}！',
            tunToggleFailed: '切换 TUN 失败，请确保拥有管理员权限。',
            tunToggleFailedDetail: '切换 TUN 失败：{error}',
            pathsSection: '应用路径',
            configDir: '配置目录',
            dataDir: '数据目录',
            openPath: '打开文件夹',
            openPathFailed: '打开失败：{error}',
            language: '语言',
            inboundPorts: '入站端口',
            portHttp: 'HTTP 端口',
            portSocks: 'SOCKS 端口',
            portMixed: '混合端口',
            portRedir: 'Redir 端口',
            portTproxy: 'TProxy 端口',
            savePorts: '保存端口',
            portsSaved: '入站端口已更新。',
            portsSaveFailed: '端口更新失败：{error}',
            showTraySpeed: '在状态栏显示流量',
            showTraySpeedHint: '在 macOS 顶部状态栏实时显示上传/下载速度',
            privilegedHelper: '静默模式 (授权)',
            privilegedHelperHint: '授权应用安装系统级辅助工具，开启 TUN 模式无需再输入密码。',
            authorize: '授权',
            uninstall: '卸载',
            reauthorize: '重新授权',
            authorized: '已授权',
            helperInstallSuccess: '静默模式授权成功！现在可以随时切换 TUN。',
            helperInstallFailed: '授权失败：{error}',
            helperUninstallSuccess: '系统服务模式已卸载',
            tunRequiresServiceMode: 'TUN 模式需要系统服务模式，请允许安装。',
            switchedToServiceModeForTun: '已切换到系统服务模式以启用 TUN',
            toggleFailed: '操作失败：{error}',
            coreMode: '运行模式',
            coreModeHint: '选择 Mihomo 在系统中的运行方式',
            userMode: '普通模式',
            serviceMode: '系统服务',
            userModeDesc: '在用户会话中运行，TUN 模式需要 sudo',
            serviceModeDesc: '以系统服务运行，具备 root 权限，开机自启',
            switchedToUserMode: '已切换到普通模式',
            switchedToServiceMode: '已切换到系统服务模式',
            coreModeSwitchFailed: '切换模式失败：{error}',
            helperRequiredForService: '请先安装系统服务模式',
        },
        profiles: {
            title: '配置订阅',
            profiles: '订阅列表',
            noProfiles: '暂无订阅',
            selectOrCreate: '选择或创建一个订阅开始编辑',
            active: '启用中',
            activate: '启用',
            update: '更新',
            delete: '删除',
            rename: '重命名',
            editorVisual: '可视化',
            editorYaml: 'YAML',
            saveChanges: '保存修改',
            generalSettings: '基础设置',
            mixedPort: '混合端口',
            mode: '模式',
            allowLan: '允许局域网',
            proxies: '节点',
            importUrl: '导入链接',
            addProxy: '新增节点',
            noProxies: '暂无节点',
            rules: '规则',
            addRule: '新增规则',
            noRules: '暂无规则',
            moreRules: '还有 {count} 条规则...',
            proxyGroups: '代理分组',
            addGroup: '新增分组',
            noGroups: '暂无分组',
            groupName: '名称',
            groupType: '类型',
            groupUrl: '测试地址（可选）',
            groupInterval: '间隔',
            groupProxies: '代理列表（每行一个）',
            dns: 'DNS',
            dnsEnable: '启用',
            dnsIpv6: 'IPv6',
            dnsUseHosts: '使用 Hosts',
            dnsEnhancedMode: '增强模式',
            dnsFakeIpRange: 'Fake-IP 范围',
            dnsNameserver: 'DNS 服务器（每行一个）',
            tun: 'TUN',
            tunEnable: '启用',
            tunStack: '栈',
            tunDevice: '设备',
            tunAutoRoute: '自动路由',
            tunAutoDetect: '自动识别网卡',
            tunMtu: 'MTU',
            addProfile: '创建新订阅',
            profileName: '订阅名称',
            profileUrl: '订阅地址（可选）',
            profilePath: '本地文件路径（可选）',
            profilePathHint: 'C:\\path\\to\\config.yaml',
            profileSource: '来源方式',
            profileSourceEmpty: '空白创建',
            profileSourceUrl: '订阅地址',
            profileSourceFile: '本地文件',
            chooseFile: '选择文件',
            createMissingUrl: '请输入订阅地址。',
            createMissingPath: '请选择本地文件。',
            filePickFailed: '打开文件选择器失败：{error}',
            create: '创建',
            cancel: 'Cancel',
            addProxyTitle: '{mode} 节点',
            nameRequired: '名称和服务器地址为必填项',
            proxyName: '名称',
            proxyType: '类型',
            proxyServer: '服务器',
            proxyPort: '端口',
            proxyPassword: '密码',
            proxyUuid: 'UUID',
            proxyCipher: '加密方式',
            proxyAlterId: 'Alter ID',
            proxyVmessCipher: 'VMess 加密',
            proxySni: 'SNI',
            proxyUdp: 'UDP',
            proxyTls: 'TLS',
            saveProxy: '保存节点',
            yamlPlaceholder: '# 在此粘贴 Clash YAML 配置...',
            importProxyUrlPrompt: '请输入代理链接（ss://、vmess://、trojan://）',
            addRulePrompt: '输入规则（例如：DOMAIN-SUFFIX,google.com,Proxy）',
            createFailed: '创建订阅失败：{error}',
            deleteConfirm: '确认删除该订阅吗？',
            deleteFailed: '删除订阅失败：{error}',
            activateConfirm: '启用该订阅并重启内核以应用配置？',
            tunRequiresHelper: '该订阅启用了 TUN，请先授权静默模式，避免每次输入密码。',
            activateFailed: '启用订阅失败：{error}',
            saveSuccess: '保存成功！',
            saveFailed: '保存失败：{error}',
            updateFailed: '更新失败：{error}',
            updateSuccess: '更新成功！',
            missingUrl: '该订阅没有订阅地址',
            renamePrompt: '重命名订阅',
            renameFailed: '重命名失败：{error}',
            downloadConfigPrompt: '请输入订阅地址',
            importFailed: '解析代理链接失败：{error}',
            proxyAdded: '节点已添加！',
            configSavedPath: '配置已保存到：{path}\n请重启内核生效。',
        },
    },
};

const storedLocale = localStorage.getItem('aqiu-locale') as Locale | null;
const locale = ref<Locale>(storedLocale || 'en');

const resolveMessage = (input: MessageValue, path: string[]): string | null => {
    let current: MessageValue = input;
    for (const key of path) {
        if (typeof current !== 'object' || current === null) {
            return null;
        }
        current = (current as Record<string, MessageValue>)[key];
        if (current === undefined) {
            return null;
        }
    }
    if (typeof current === 'string') {
        return current;
    }
    return null;
};

const formatMessage = (message: string, params?: Record<string, string | number>) => {
    if (!params) return message;
    return Object.keys(params).reduce((result, key) => {
        const value = String(params[key]);
        return result.replace(new RegExp(`\\{${key}\\}`, 'g'), value);
    }, message);
};

export function useI18n() {
    const t = (key: string, params?: Record<string, string | number>) => {
        const path = key.split('.');
        const current = resolveMessage(messages[locale.value], path)
            ?? resolveMessage(messages.en, path)
            ?? key;
        return formatMessage(current, params);
    };

    const setLocale = (next: Locale) => {
        locale.value = next;
        localStorage.setItem('aqiu-locale', next);
    };

    return {
        locale,
        t,
        setLocale,
        availableLocales: [
            { value: 'en', label: 'English' },
            { value: 'zh', label: '中文' },
        ],
    };
}
